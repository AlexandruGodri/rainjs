

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Authorization &mdash; Rain v0.6.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Rain v0.6.0 documentation" href="../index.html" />
    <link rel="next" title="Error component" href="error_component.html" />
    <link rel="prev" title="Guidelines for writing a Handlebars helper" href="handlebars/how_to_write_a_helper.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="error_component.html" title="Error component"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="handlebars/how_to_write_a_helper.html" title="Guidelines for writing a Handlebars helper"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Rain v0.6.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="authorization">
<h1>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h1>
<p>Rain handles authorization in two ways. First it uses a permision based authorization system that
checks if the user has the required permissions for viewing a component and it&#8217;s views, and secondly
there is a dynamic condition module that allows for defining custom conditions that are not covered by
the permissions (for example checking the user&#8217;s country).</p>
<div class="section" id="permissions-based">
<h2>Permissions based<a class="headerlink" href="#permissions-based" title="Permalink to this headline">¶</a></h2>
<p>The permission based model allows for defining of permissions at both component and view level which
will be checked against the permissions the user has. The permissions should be defined in the <tt class="docutils literal"><span class="pre">meta.json</span></tt>
file located in the component root under the <tt class="docutils literal"><span class="pre">permissions</span></tt> key of both the component and it&#8217;s views, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;example_app&quot;</span><span class="p">,</span>
    <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="s">&quot;url&quot;</span><span class="p">:</span> <span class="s">&quot;/components/example_app&quot;</span><span class="p">,</span>
    <span class="s">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;example&quot;</span><span class="p">],</span>
    <span class="s">&quot;views&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s">&quot;viewid&quot;</span><span class="p">:</span> <span class="s">&quot;index&quot;</span><span class="p">,</span>
          <span class="s">&quot;view&quot;</span><span class="p">:</span> <span class="s">&quot;/htdocs/index.html&quot;</span><span class="p">,</span>
          <span class="s">&quot;controller&quot;</span><span class="p">:</span> <span class="s">&quot;/htdocs/controller/index.js&quot;</span><span class="p">,</span>
          <span class="s">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;example-index&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The permissions are evaluated in the following order:</p>
<p>When a view is requested, authorization is done by the system in the following order:</p>
<ol class="arabic simple">
<li>If permissions are defined at component level, it checks that the user has those permissions.</li>
<li>If permissions are defined at view level, it checks that the user has those permissions.</li>
<li>If a dynamic condition is defined at module level, it tests if the condition passes.</li>
<li>If a dynamic condition is defined at view level, it tests if the condition passes.</li>
</ol>
<p>In case any of these conditions fail a <em>401</em> view will be rendered instead of the requested view.
This works independently of the context (so you don&#8217;t have to worry if you&#8217;re in an agregated context
or you component is supposed to be accessed directly.</p>
</div>
<div class="section" id="dynamic-conditions">
<h2>Dynamic Conditions<a class="headerlink" href="#dynamic-conditions" title="Permalink to this headline">¶</a></h2>
<p>Dynamic conditions provide a way to register complex security conditions that will be run
in order to determine if an user is allowed to access a view. Dynamic conditions are evaluated only
after the role authorization step is performed.</p>
<p>Dynamic conditions can be specified at component and/or view level.</p>
<p>If any of these conditons aren&#8217;t met, it stops without executing the remaining conditions and
it doesn&#8217;t allow the user to access the view.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This should be used only if the standard authorization mechanism can&#8217;t handle the scenario
that needs to be implemented. Writing dynamic conditions will make the process of
changing which users can access components very time consuming, especially if this is used in many
components (because the code for the components needs to be changed).
Also, in some situations, it can make the application slower because the rendering of a component
starts only after all the authorization conditions are executed.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>Dynamic conditions are placed in the <tt class="docutils literal"><span class="pre">/authorization/dynamic.js</span></tt> file and are auto-discovered
(convention over configuration). In order to define a dynamic condition for a view a function
with the same name as the <em>view id</em> should be created in this file and exported as part of the public
API of this module. For the component level dynamic conditions, the name of this function is
<tt class="docutils literal"><span class="pre">_component</span></tt>. If any of these functions is missing, the dynamic condition is simply ignored.</p>
<p>The dynamic conditon function will receive <tt class="docutils literal"><span class="pre">securityContext</span></tt> as its argument. It contains an <tt class="docutils literal"><span class="pre">user</span></tt>
property, which is an object that contains information about the current user. The <tt class="docutils literal"><span class="pre">securityContext</span></tt>
parameter is read-only. This object is populated when the user is authenticated and it is kept in session.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We don&#8217;t use data received from the client in the HTTP request because it&#8217;s unreliable and can be easily
modified by the user.</p>
</div>
<p>The dynamic condition should return <tt class="docutils literal"><span class="pre">true</span></tt> if the user is allowed to access the view, and <tt class="docutils literal"><span class="pre">false</span></tt> otherwise.
Any other value is threated as <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Async code isn&#8217;t allowed in dynamic conditions. This is done for performance reasons, because if we allow
this Rain will be forced to wait until the async call finishes before starting to render the view.</p>
</div>
<p>The following example demonstrates how dynamic conditions can be used (the content of the
<em>meta.json</em> file is shown in order to make it clear how dynamic conditions are mapped to views).</p>
<p>/meta.json:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;button&quot;</span><span class="p">,</span>
    <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="s">&quot;url&quot;</span><span class="p">:</span> <span class="s">&quot;/components/button&quot;</span><span class="p">,</span>
    <span class="s">&quot;views&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s">&quot;viewid&quot;</span><span class="p">:</span> <span class="s">&quot;index&quot;</span><span class="p">,</span>
        <span class="s">&quot;view&quot;</span><span class="p">:</span> <span class="s">&quot;/htdocs/index.html&quot;</span><span class="p">,</span>
        <span class="s">&quot;controller&quot;</span><span class="p">:</span> <span class="s">&quot;/htdocs/controller/index.js&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">&quot;viewid&quot;</span><span class="p">:</span> <span class="s">&quot;view&quot;</span><span class="p">,</span>
        <span class="s">&quot;view&quot;</span><span class="p">:</span> <span class="s">&quot;/htdocs/view.html&quot;</span><span class="p">,</span>
        <span class="s">&quot;controller&quot;</span><span class="p">:</span> <span class="s">&quot;/htdocs/controller/view.js&quot;</span>
    <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>/authorization/dynamic.js:</p>
<div class="highlight-python"><pre>function _component(securityContext) {
    var products = securityContext.user.products;

    for (var i = 0, length = products.length; i &lt; length; i++) {
        if (products[i].name === 'Control Panel') {
            return true;
        }
    }

    return false;
}

function index(securityContext) {
    return securityContext.user.country === 'US';
}

function view(securityContext) {
    return securityContext.user.language === 'de_DE';
}

module.exports = {
    _component: _component,
    index: index,
    view: view
};</pre>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><tt class="xref js js-class docutils literal"><span class="pre">Authorization()</span></tt></dt>
<dd>Authorization API</dd>
</dl>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Authorization</a><ul>
<li><a class="reference internal" href="#permissions-based">Permissions based</a></li>
<li><a class="reference internal" href="#dynamic-conditions">Dynamic Conditions</a><ul>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="handlebars/how_to_write_a_helper.html"
                        title="previous chapter">Guidelines for writing a Handlebars helper</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="error_component.html"
                        title="next chapter">Error component</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="error_component.html" title="Error component"
             >next</a> |</li>
        <li class="right" >
          <a href="handlebars/how_to_write_a_helper.html" title="Guidelines for writing a Handlebars helper"
             >previous</a> |</li>
        <li><a href="../index.html">Rain v0.6.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>